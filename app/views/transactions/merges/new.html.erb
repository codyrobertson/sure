<%= render DS::Dialog.new(variant: "drawer", frame: "merge_transaction_drawer") do |dialog| %>
  <% dialog.with_header(title: t(".title"), subtitle: t(".subtitle", count: @entries.size)) %>

  <% dialog.with_body do %>
    <%= styled_form_with url: transactions_merge_path, scope: "merge", class: "h-full flex flex-col justify-between gap-4", data: { turbo_frame: "_top" } do |form| %>
      <div class="space-y-4">
        <p class="text-sm text-secondary"><%= t(".select_primary") %></p>

        <div class="space-y-2 max-h-[400px] overflow-y-auto">
          <% @entries.each_with_index do |entry, index| %>
            <%= form.hidden_field :entry_ids, multiple: true, value: entry.id %>
            <label class="flex items-start gap-3 p-3 rounded-lg border border-primary cursor-pointer hover:bg-container-inset has-[:checked]:border-link has-[:checked]:bg-container-inset">
              <%= form.radio_button :primary_entry_id, entry.id, checked: index == 0, class: "radio mt-1" %>
              <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between gap-2">
                  <span class="font-medium text-primary truncate"><%= entry.name %></span>
                  <span class="text-sm font-medium <%= entry.amount.negative? ? "text-success" : "text-primary" %>">
                    <%= format_money(entry.amount_money) %>
                  </span>
                </div>
                <div class="flex items-center gap-2 text-xs text-secondary mt-1">
                  <span><%= l(entry.date, format: :short) %></span>
                  <span>&middot;</span>
                  <span><%= entry.account.name %></span>
                  <% if entry.transaction? && entry.transaction.category %>
                    <span>&middot;</span>
                    <span><%= entry.transaction.category.name %></span>
                  <% end %>
                </div>
              </div>
            </label>
          <% end %>
        </div>

        <div class="pt-4 border-t border-divider">
          <label class="flex items-center gap-2 cursor-pointer">
            <%= form.check_box :sum_amounts, class: "checkbox" %>
            <span class="text-sm text-secondary"><%= t(".sum_amounts") %></span>
          </label>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-auto">
        <%= render DS::Button.new(text: t(".cancel"), variant: "ghost", data: { action: "click->DS--dialog#close" }) %>
        <%= render DS::Button.new(text: t(".merge"), variant: "primary") %>
      </div>
    <% end %>
  <% end %>
<% end %>
