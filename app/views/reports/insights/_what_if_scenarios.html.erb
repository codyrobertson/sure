<% return unless data.present? %>

<div class="space-y-6">
  <%# Easy Wins Card %>
  <% if data[:easy_wins] && data[:easy_wins][:actions].any? %>
    <div class="bg-success/10 border border-success/30 rounded-xl p-5">
      <div class="flex items-center gap-2 mb-4">
        <%= icon("zap", class: "w-5 h-5 text-success") %>
        <h4 class="text-sm font-medium text-success">
          <%= t("reports.insights.what_if.easy_wins") %>
        </h4>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div class="bg-container rounded-lg p-4 text-center">
          <p class="text-2xl font-semibold text-success"><%= data[:easy_wins][:total_monthly_savings][:formatted] %></p>
          <p class="text-xs text-secondary"><%= t("reports.insights.what_if.monthly_potential") %></p>
        </div>
        <div class="bg-container rounded-lg p-4 text-center">
          <p class="text-2xl font-semibold text-success"><%= data[:easy_wins][:total_annual_savings][:formatted] %></p>
          <p class="text-xs text-secondary"><%= t("reports.insights.what_if.annual_potential") %></p>
        </div>
        <div class="bg-container rounded-lg p-4 text-center">
          <p class="text-2xl font-semibold text-success">+<%= data[:easy_wins][:savings_rate_impact] %>%</p>
          <p class="text-xs text-secondary"><%= t("reports.insights.what_if.savings_rate_boost") %></p>
        </div>
      </div>

      <table class="w-full text-sm">
        <tbody>
          <% data[:easy_wins][:actions].each do |action| %>
            <% difficulty_class = case action[:difficulty]
              when :easy then 'bg-success/20 text-success'
              when :moderate then 'bg-warning/20 text-warning'
              else 'bg-secondary/20 text-secondary'
            end %>

            <tr class="border-b border-success/20 last:border-0">
              <td class="py-2.5">
                <div class="flex items-center gap-2">
                  <span class="text-xs px-2 py-0.5 rounded-full <%= difficulty_class %>">
                    <%= action[:difficulty].to_s.humanize %>
                  </span>
                  <span class="text-primary"><%= action[:action] %></span>
                </div>
              </td>
              <td class="py-2.5 text-right font-medium text-success"><%= action[:monthly_savings][:formatted] %>/mo</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>

  <%# Impact Comparison Card %>
  <% if data[:impact_summary].any? %>
    <div class="bg-container rounded-xl shadow-border-xs p-5">
      <h4 class="text-sm font-medium text-primary mb-4">
        <%= t("reports.insights.what_if.scenario_comparison") %>
      </h4>

      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-secondary/30">
              <th class="text-left py-2 text-xs text-subdued font-medium"><%= t("reports.insights.what_if.scenario") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.what_if.savings_rate") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.what_if.monthly_savings") %></th>
            </tr>
          </thead>
          <tbody>
            <% data[:impact_summary].each_with_index do |scenario, index| %>
              <% is_current = index == 0 %>
              <tr class="border-b border-secondary/20 last:border-0">
                <td class="py-2.5">
                  <div class="flex items-center gap-2">
                    <span class="font-medium text-primary"><%= scenario[:name] %></span>
                    <% if is_current %>
                      <span class="text-xs px-1.5 py-0.5 bg-secondary/20 rounded text-subdued"><%= t("reports.insights.what_if.current_badge") %></span>
                    <% end %>
                  </div>
                </td>
                <td class="py-2.5 text-right font-semibold <%= scenario[:savings_rate] >= 20 ? 'text-success' : scenario[:savings_rate] >= 0 ? 'text-warning' : 'text-destructive' %>">
                  <%= scenario[:savings_rate] %>%
                </td>
                <td class="py-2.5 text-right <%= scenario[:monthly_savings][:amount] >= 0 ? 'text-success' : 'text-destructive' %>">
                  <%= scenario[:monthly_savings][:formatted] %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <%# Category Reduction Scenarios Card %>
  <% if data[:category_scenarios].any? %>
    <div class="bg-container rounded-xl shadow-border-xs p-5">
      <h4 class="text-sm font-medium text-primary mb-4">
        <%= t("reports.insights.what_if.category_reductions") %>
      </h4>

      <div class="space-y-4">
        <% data[:category_scenarios].each do |category| %>
          <div class="border-b border-secondary/20 pb-4 last:border-0 last:pb-0">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full" style="background-color: <%= category[:category][:color] %>;"></div>
                <span class="font-medium text-primary"><%= category[:category][:name] %></span>
              </div>
              <span class="text-sm text-secondary"><%= t("reports.insights.what_if.current_label") %>: <%= category[:current][:formatted] %></span>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
              <% category[:reductions].each do |reduction| %>
                <div class="bg-surface-inset rounded-lg p-3 text-center">
                  <p class="text-xs text-subdued mb-1"><%= t("reports.insights.what_if.cut_by", percent: reduction[:percent]) %></p>
                  <p class="font-medium text-success"><%= reduction[:monthly_savings][:formatted] %>/mo</p>
                  <p class="text-xs text-secondary"><%= reduction[:annual_savings][:formatted] %>/yr</p>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Subscription Scenarios Card %>
  <% if data[:subscription_scenarios].any? %>
    <div class="bg-container rounded-xl shadow-border-xs p-5">
      <h4 class="text-sm font-medium text-primary mb-4">
        <%= t("reports.insights.what_if.subscription_review") %>
      </h4>

      <table class="w-full text-sm">
        <tbody>
          <% data[:subscription_scenarios].each do |sub| %>
            <% priority_class = case sub[:priority]
              when 1 then 'bg-success/10 text-success'
              when 2 then 'bg-warning/10 text-warning'
              else 'bg-secondary/10 text-secondary'
            end %>

            <tr class="border-b border-secondary/20 last:border-0">
              <td class="py-2.5">
                <div class="flex items-center gap-2">
                  <span class="text-xs px-2 py-0.5 rounded <%= priority_class %>">
                    <%= sub[:priority_label] %>
                  </span>
                  <div>
                    <p class="font-medium text-primary"><%= sub[:recurring_transaction][:name] %></p>
                    <% if sub[:recurring_transaction][:category] %>
                      <p class="text-xs text-subdued"><%= sub[:recurring_transaction][:category] %></p>
                    <% end %>
                  </div>
                </div>
              </td>
              <td class="py-2.5 text-right">
                <p class="font-medium text-primary"><%= sub[:monthly_cost][:formatted] %>/mo</p>
                <p class="text-xs text-subdued"><%= sub[:annual_cost][:formatted] %>/yr</p>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>

  <%# Insights %>
  <% if data[:insights].present? %>
    <div class="space-y-2">
      <% data[:insights].each do |insight| %>
        <% colors = { positive: "text-success", warning: "text-warning", alert: "text-destructive" } %>
        <% icons = { positive: "lightbulb", warning: "alert-triangle", alert: "alert-circle" } %>

        <div class="flex items-start gap-2 text-sm">
          <%= icon(icons[insight[:severity]] || "info", class: "w-4 h-4 mt-0.5 flex-shrink-0 #{colors[insight[:severity]] || 'text-secondary'}") %>
          <p class="text-primary"><%= insight[:message] %></p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
