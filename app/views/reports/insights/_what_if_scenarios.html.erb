<% return unless data.present? %>

<div class="space-y-8">
  <%# Easy Wins - Highlighted section %>
  <% if data[:easy_wins] && data[:easy_wins][:actions].any? %>
    <div class="border-l-2 border-success pl-4">
      <div class="flex items-center gap-2 mb-4">
        <%= icon("zap", class: "w-4 h-4 text-success") %>
        <span class="text-sm font-medium text-success">
          <%= t("reports.insights.what_if.easy_wins") %>
        </span>
      </div>

      <div class="grid grid-cols-3 gap-6 mb-4">
        <div>
          <p class="text-2xl font-semibold text-success"><%= data[:easy_wins][:total_monthly_savings][:formatted] %></p>
          <p class="text-xs text-secondary"><%= t("reports.insights.what_if.monthly_potential") %></p>
        </div>
        <div>
          <p class="text-2xl font-semibold text-success"><%= data[:easy_wins][:total_annual_savings][:formatted] %></p>
          <p class="text-xs text-secondary"><%= t("reports.insights.what_if.annual_potential") %></p>
        </div>
        <div>
          <p class="text-2xl font-semibold text-success">+<%= data[:easy_wins][:savings_rate_impact] %>%</p>
          <p class="text-xs text-secondary"><%= t("reports.insights.what_if.savings_rate_boost") %></p>
        </div>
      </div>

      <div class="divide-y divide-secondary/20">
        <% data[:easy_wins][:actions].each do |action| %>
          <% difficulty_class = case action[:difficulty]
            when :easy then 'text-success'
            when :moderate then 'text-warning'
            else 'text-secondary'
          end %>

          <div class="flex items-center justify-between py-2 first:pt-0 last:pb-0">
            <div class="flex items-center gap-2">
              <span class="text-xs <%= difficulty_class %>">
                <%= action[:difficulty].to_s.humanize %>
              </span>
              <span class="text-sm text-primary"><%= action[:action] %></span>
            </div>
            <div class="text-right text-sm">
              <span class="font-medium text-success"><%= action[:monthly_savings][:formatted] %>/mo</span>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Impact Comparison - Simple list %>
  <% if data[:impact_summary].any? %>
    <div>
      <p class="text-sm text-secondary mb-4">
        <%= t("reports.insights.what_if.scenario_comparison") %>
      </p>

      <div class="space-y-3">
        <% data[:impact_summary].each_with_index do |scenario, index| %>
          <% is_current = index == 0 %>
          <% bar_width = scenario[:savings_rate] > 0 ? [scenario[:savings_rate], 50].min * 2 : 0 %>

          <div class="<%= is_current ? '' : 'pl-4 border-l-2 border-success/40' %>">
            <div class="flex items-center justify-between mb-1">
              <span class="font-medium text-primary flex items-center gap-2">
                <%= scenario[:name] %>
                <% if is_current %>
                  <span class="text-xs px-1.5 py-0.5 bg-secondary/20 rounded text-tertiary">Current</span>
                <% end %>
              </span>
              <span class="text-lg font-semibold <%= scenario[:savings_rate] >= 20 ? 'text-success' : scenario[:savings_rate] >= 0 ? 'text-warning' : 'text-destructive' %>">
                <%= scenario[:savings_rate] %>%
              </span>
            </div>

            <div class="h-1.5 bg-secondary/20 rounded-full overflow-hidden mb-1">
              <div class="h-full <%= is_current ? 'bg-secondary' : 'bg-success' %> rounded-full" style="width: <%= bar_width %>%;"></div>
            </div>

            <div class="flex items-center justify-between text-xs">
              <span class="text-tertiary"><%= t("reports.insights.what_if.monthly_savings") %></span>
              <span class="<%= scenario[:monthly_savings][:amount] >= 0 ? 'text-success' : 'text-destructive' %>">
                <%= scenario[:monthly_savings][:formatted] %>
              </span>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Category Reduction Scenarios %>
  <% if data[:category_scenarios].any? %>
    <div>
      <p class="text-sm text-secondary mb-4">
        <%= t("reports.insights.what_if.category_reductions") %>
      </p>

      <div class="divide-y divide-secondary/20">
        <% data[:category_scenarios].each do |category| %>
          <div class="py-4 first:pt-0 last:pb-0">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full" style="background-color: <%= category[:category][:color] %>;"></div>
                <span class="font-medium text-primary"><%= category[:category][:name] %></span>
              </div>
              <span class="text-sm text-secondary"><%= category[:current][:formatted] %>/mo</span>
            </div>

            <div class="grid grid-cols-3 gap-4 text-sm">
              <% category[:reductions].each do |reduction| %>
                <div class="text-center">
                  <p class="text-xs text-tertiary mb-1"><%= t("reports.insights.what_if.cut_by", percent: reduction[:percent]) %></p>
                  <p class="font-medium text-success"><%= reduction[:monthly_savings][:formatted] %></p>
                  <p class="text-xs text-tertiary"><%= reduction[:annual_savings][:formatted] %>/yr</p>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Subscription Scenarios %>
  <% if data[:subscription_scenarios].any? %>
    <div>
      <p class="text-sm text-secondary mb-4">
        <%= t("reports.insights.what_if.subscription_review") %>
      </p>

      <div class="divide-y divide-secondary/20">
        <% data[:subscription_scenarios].each do |sub| %>
          <% priority_class = case sub[:priority]
            when 1 then 'text-success'
            when 2 then 'text-warning'
            else 'text-secondary'
          end %>

          <div class="flex items-center justify-between py-3 first:pt-0 last:pb-0">
            <div class="flex items-center gap-2">
              <span class="text-xs <%= priority_class %>">
                <%= sub[:priority_label] %>
              </span>
              <div>
                <p class="font-medium text-primary"><%= sub[:recurring_transaction][:name] %></p>
                <% if sub[:recurring_transaction][:category] %>
                  <p class="text-xs text-tertiary"><%= sub[:recurring_transaction][:category] %></p>
                <% end %>
              </div>
            </div>
            <div class="text-right text-sm">
              <p class="font-medium text-primary"><%= sub[:monthly_cost][:formatted] %>/mo</p>
              <p class="text-xs text-tertiary"><%= sub[:annual_cost][:formatted] %>/yr</p>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Insights %>
  <% if data[:insights].present? %>
    <div class="space-y-2 pt-4 border-t border-secondary/20">
      <% data[:insights].each do |insight| %>
        <% colors = { positive: "text-success", warning: "text-warning", alert: "text-destructive" } %>
        <% icons = { positive: "lightbulb", warning: "alert-triangle", alert: "alert-circle" } %>

        <div class="flex items-start gap-2 text-sm">
          <%= icon(icons[insight[:severity]] || "info", class: "w-4 h-4 mt-0.5 flex-shrink-0 #{colors[insight[:severity]] || 'text-secondary'}") %>
          <p class="text-primary"><%= insight[:message] %></p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
