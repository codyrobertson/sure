<% return unless data.present? %>

<div class="space-y-8">
  <%# Alerts - Simple inline style %>
  <% if data[:alerts].any? %>
    <div class="space-y-2">
      <% data[:alerts].each do |alert| %>
        <% icon_class = case alert[:severity]
          when :alert then "text-destructive"
          when :warning then "text-warning"
          else "text-secondary"
        end %>
        <% icon_name = case alert[:severity]
          when :alert then "alert-circle"
          when :warning then "alert-triangle"
          else "info"
        end %>

        <div class="flex items-start gap-2 text-sm">
          <%= icon(icon_name, class: "w-4 h-4 mt-0.5 flex-shrink-0 #{icon_class}") %>
          <p class="text-primary"><%= alert[:message] %></p>
        </div>
      <% end %>
    </div>
  <% end %>

  <%# Income Timing - Simple highlight %>
  <% if data[:income_timing] %>
    <div class="border-l-2 border-success pl-4 py-2">
      <div class="flex items-center gap-2 mb-2">
        <%= icon("calendar-check", class: "w-4 h-4 text-success") %>
        <span class="text-sm text-secondary"><%= t("reports.insights.cash_flow_timing.next_income") %></span>
      </div>

      <div class="flex items-baseline gap-4">
        <span class="text-2xl font-semibold text-success"><%= data[:income_timing][:amount][:formatted] %></span>
        <span class="text-sm text-secondary">
          in <span class="font-medium text-primary"><%= data[:income_timing][:days_until] %></span> days
          (<%= Date.parse(data[:income_timing][:next_paycheck_date]).strftime("%b %d") %>)
        </span>
      </div>
    </div>
  <% end %>

  <%# Balance Projection Chart - No container %>
  <% if data[:balance_projection].any? %>
    <div>
      <p class="text-sm text-secondary mb-4">
        <%= t("reports.insights.cash_flow_timing.balance_projection") %>
      </p>

      <%# Mini chart %>
      <div class="relative h-20 flex items-end gap-0.5">
        <% projections = data[:balance_projection].first(14) %>
        <% max_balance = projections.map { |p| p[:projected_balance][:amount] }.max %>
        <% min_balance = projections.map { |p| p[:projected_balance][:amount] }.min %>
        <% range = max_balance - min_balance %>
        <% range = 1 if range.zero? %>

        <% projections.each_with_index do |day, idx| %>
          <% height_percent = ((day[:projected_balance][:amount] - min_balance) / range * 80 + 20).round %>
          <% bar_color = day[:is_low] ? 'bg-destructive' : 'bg-primary' %>
          <% has_activity = day[:inflows][:amount] > 0 || day[:outflows][:amount] > 0 %>
          <% is_current = idx == 0 %>

          <div class="flex-1 flex flex-col items-center justify-end h-full"
               title="<%= Date.parse(day[:date]).strftime('%b %d') %>: <%= day[:projected_balance][:formatted] %>">
            <div class="w-full <%= bar_color %> <%= is_current ? 'opacity-100' : has_activity ? 'opacity-70' : 'opacity-40' %> rounded-t"
                 style="height: <%= height_percent %>%;"></div>
          </div>
        <% end %>
      </div>

      <div class="flex justify-between mt-2 text-xs text-tertiary">
        <span><%= t("reports.insights.cash_flow_timing.today") %></span>
        <span><%= t("reports.insights.cash_flow_timing.in_two_weeks") %></span>
      </div>
    </div>
  <% end %>

  <%# Upcoming Bills - Simple list with dividers %>
  <% if data[:upcoming_bills].any? %>
    <div>
      <div class="flex items-center gap-2 mb-3">
        <%= icon("receipt", class: "w-4 h-4 text-secondary") %>
        <p class="text-sm text-secondary">
          <%= t("reports.insights.cash_flow_timing.upcoming_bills") %>
        </p>
      </div>

      <div class="divide-y divide-secondary/20">
        <% data[:upcoming_bills].first(6).each do |bill| %>
          <div class="flex items-center justify-between py-3 first:pt-0 last:pb-0">
            <div class="flex items-center gap-3">
              <div class="text-center min-w-10">
                <p class="text-lg font-semibold text-primary"><%= Date.parse(bill[:date]).day %></p>
                <p class="text-xs text-tertiary"><%= Date.parse(bill[:date]).strftime("%b") %></p>
              </div>
              <div>
                <p class="font-medium text-primary"><%= bill[:name] %></p>
                <% if bill[:category] %>
                  <p class="text-xs text-tertiary"><%= bill[:category] %></p>
                <% end %>
              </div>
            </div>
            <div class="text-right">
              <p class="font-medium text-primary"><%= bill[:amount][:formatted] %></p>
              <% if bill[:can_afford] %>
                <p class="text-xs text-success">
                  <%= t("reports.insights.cash_flow_timing.can_afford") %>
                </p>
              <% else %>
                <p class="text-xs text-destructive">
                  <%= t("reports.insights.cash_flow_timing.short") %>
                </p>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Weekly Summary - Simple grid %>
  <% if data[:daily_summary].any? %>
    <div>
      <p class="text-sm text-secondary mb-4">
        <%= t("reports.insights.cash_flow_timing.weekly_outlook") %>
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <% data[:daily_summary].each_with_index do |week, index| %>
          <div class="border-l-2 border-secondary/40 pl-4">
            <div class="flex items-center justify-between mb-2">
              <span class="font-medium text-primary">
                <% if index == 0 %>
                  <%= t("reports.insights.cash_flow_timing.this_week") %>
                <% else %>
                  <%= t("reports.insights.cash_flow_timing.next_week") %>
                <% end %>
              </span>
              <span class="text-xs text-tertiary">
                <%= Date.parse(week[:start_date]).strftime("%b %d") %> - <%= Date.parse(week[:end_date]).strftime("%b %d") %>
              </span>
            </div>

            <div class="space-y-1 text-sm">
              <div class="flex items-center justify-between">
                <span class="text-tertiary"><%= t("reports.insights.cash_flow_timing.inflows") %></span>
                <span class="font-medium text-success">+<%= week[:total_inflows][:formatted] %></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-tertiary"><%= t("reports.insights.cash_flow_timing.outflows") %></span>
                <span class="font-medium text-destructive">-<%= week[:total_outflows][:formatted] %></span>
              </div>
              <div class="flex items-center justify-between pt-1 border-t border-secondary/20">
                <span class="text-tertiary"><%= t("reports.insights.cash_flow_timing.net") %></span>
                <% net = week[:net][:amount] %>
                <span class="font-medium <%= net >= 0 ? 'text-success' : 'text-destructive' %>">
                  <%= week[:net][:formatted] %>
                </span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Insights %>
  <% if data[:insights].present? %>
    <div class="space-y-2 pt-4 border-t border-secondary/20">
      <% data[:insights].each do |insight| %>
        <% colors = { positive: "text-success", warning: "text-warning", alert: "text-destructive" } %>
        <% icons = { positive: "check-circle", warning: "alert-triangle", alert: "alert-circle" } %>

        <div class="flex items-start gap-2 text-sm">
          <%= icon(icons[insight[:severity]] || "info", class: "w-4 h-4 mt-0.5 flex-shrink-0 #{colors[insight[:severity]] || 'text-secondary'}") %>
          <p class="text-primary"><%= insight[:message] %></p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
