<% return unless data.present? %>

<div class="space-y-6">
  <%# Key Metrics Card %>
  <div class="bg-container rounded-xl shadow-border-xs p-5">
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-6">
      <div>
        <p class="text-sm text-secondary mb-1"><%= t("reports.insights.debt_payoff.total_debt") %></p>
        <p class="text-2xl font-semibold text-destructive">
          <%= data[:total_debt][:formatted] %>
        </p>
      </div>

      <div>
        <p class="text-sm text-secondary mb-1"><%= t("reports.insights.debt_payoff.paid_this_period") %></p>
        <p class="text-2xl font-semibold text-primary">
          <%= data[:progress][:total_paid][:formatted] %>
        </p>
      </div>

      <div>
        <p class="text-sm text-secondary mb-1"><%= t("reports.insights.debt_payoff.principal") %></p>
        <p class="text-2xl font-semibold text-success">
          <%= data[:progress][:principal_paid][:formatted] %>
        </p>
      </div>

      <div>
        <p class="text-sm text-secondary mb-1"><%= t("reports.insights.debt_payoff.interest") %></p>
        <p class="text-2xl font-semibold text-warning">
          <%= data[:interest_this_period][:formatted] %>
        </p>
      </div>
    </div>
  </div>

  <%# Principal vs Interest Bar Card %>
  <% if data[:progress][:total_paid][:amount] > 0 %>
    <div class="bg-container rounded-xl shadow-border-xs p-5">
      <div class="flex items-center justify-between mb-3">
        <p class="text-sm font-medium text-primary"><%= t("reports.insights.debt_payoff.payment_breakdown") %></p>
        <p class="text-sm text-secondary">
          <%= data[:progress][:principal_percent].round(1) %>% <%= t("reports.insights.debt_payoff.to_principal") %>
        </p>
      </div>

      <div class="h-3 bg-secondary/20 rounded-full overflow-hidden flex">
        <% principal_pct = data[:progress][:principal_percent] %>
        <div class="h-full bg-success" style="width: <%= principal_pct %>%;"></div>
        <div class="h-full bg-warning" style="width: <%= 100 - principal_pct %>%;"></div>
      </div>

      <div class="flex items-center gap-4 mt-3 text-xs text-subdued">
        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded bg-success"></span> <%= t("reports.insights.debt_payoff.principal") %></span>
        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded bg-warning"></span> <%= t("reports.insights.debt_payoff.interest") %></span>
      </div>
    </div>
  <% end %>

  <%# Individual Debts Card %>
  <% if data[:debts].any? %>
    <div class="bg-container rounded-xl shadow-border-xs p-5">
      <p class="text-sm font-medium text-primary mb-4"><%= t("reports.insights.debt_payoff.your_debts") %></p>

      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-secondary/30">
              <th class="text-left py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.account") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.interest_rate") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.monthly_payment") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.payoff_date") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.balance") %></th>
            </tr>
          </thead>
          <tbody>
            <% data[:debts].each do |debt| %>
              <tr class="border-b border-secondary/20 last:border-0">
                <td class="py-3">
                  <div class="flex items-center gap-2">
                    <% icon_name = debt[:account][:type] == "CreditCard" ? "credit-card" : "landmark" %>
                    <%= icon(icon_name, class: "w-4 h-4 text-secondary") %>
                    <span class="font-medium text-primary"><%= debt[:account][:name] %></span>
                  </div>
                </td>
                <td class="py-3 text-right text-primary"><%= debt[:interest_rate] %>%</td>
                <td class="py-3 text-right text-primary"><%= debt[:monthly_payment][:formatted] %></td>
                <td class="py-3 text-right text-subdued">
                  <%= debt[:payoff_date] ? debt[:payoff_date].strftime("%b %Y") : "—" %>
                </td>
                <td class="py-3 text-right font-semibold text-destructive"><%= debt[:balance][:formatted] %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <%# Acceleration Scenarios Card %>
  <% if data[:acceleration_scenarios].any? %>
    <div class="bg-container rounded-xl shadow-border-xs p-5">
      <div class="flex items-center gap-2 mb-1">
        <%= icon("zap", class: "w-4 h-4 text-warning") %>
        <p class="text-sm font-medium text-primary"><%= t("reports.insights.debt_payoff.acceleration_title") %></p>
      </div>
      <p class="text-xs text-secondary mb-4"><%= t("reports.insights.debt_payoff.acceleration_description") %></p>

      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-secondary/30">
              <th class="text-left py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.extra_monthly") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.months_saved") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.interest_saved") %></th>
              <th class="text-right py-2 text-xs text-subdued font-medium"><%= t("reports.insights.debt_payoff.new_payoff") %></th>
            </tr>
          </thead>
          <tbody>
            <% data[:acceleration_scenarios].each do |scenario| %>
              <tr class="border-b border-secondary/10 last:border-0">
                <td class="py-2.5 font-medium text-primary">+<%= scenario[:extra_monthly][:formatted] %></td>
                <td class="py-2.5 text-right text-success">
                  <%= scenario[:months_saved] > 0 ? "#{scenario[:months_saved]} mo" : "—" %>
                </td>
                <td class="py-2.5 text-right text-success font-medium"><%= scenario[:interest_saved][:formatted] %></td>
                <td class="py-2.5 text-right text-secondary">
                  <%= scenario[:new_payoff_date] ? scenario[:new_payoff_date].strftime("%b %Y") : "—" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <%# Insights %>
  <% if data[:insights].present? %>
    <div class="space-y-2">
      <% data[:insights].each do |insight| %>
        <% colors = { positive: "text-success", warning: "text-warning", alert: "text-destructive", info: "text-secondary" } %>
        <% icons = { positive: "check-circle", warning: "alert-triangle", alert: "alert-circle", info: "lightbulb" } %>

        <div class="flex items-start gap-2 text-sm">
          <%= icon(icons[insight[:severity]] || "info", class: "w-4 h-4 mt-0.5 flex-shrink-0 #{colors[insight[:severity]] || 'text-secondary'}") %>
          <p class="text-primary"><%= insight[:message] %></p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
